[include mainsail.cfg]
[include macros.cfg]
[include KAMP_Settings.cfg]
[include macros.cfg]
[include mpc.cfg]

#[include adxl.cfg]

[exclude_object]

[force_move]
enable_force_move: True

[mcu]
##--------------------------------------------------------------------
canbus_uuid: ed9d56fc580e
##--------------------------------------------------------------------
[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_82E206625157355957202020FF0F3A18-if00
contact_max_hotend_temperature: 200 # increase to probe at print temps

x_offset: 0 # update with offset from nozzle on your machine
y_offset: 20 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
home_xy_position: 150, 150 # update with your bed center
home_z_hop: 3
home_z_hop_speed: 15
home_xy_move_speed: 300
home_method: proximity
home_method_when_homed: proximity
home_autocalibrate: never

home_gcode_pre_x: Case_Light_Full
home_gcode_pre_y: Case_Light_Full

[mcu EBBCan]
canbus_uuid:  95cb48795317

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 4.637
nozzle_diameter: 0.400
filament_diameter: 1.750

heater_pin: EBBCan: PB13
min_extrude_temp: 0
min_temp: 0
max_temp: 350
max_extrude_only_distance: 500.0
max_extrude_only_velocity: 120
max_extrude_cross_section: 5

#control: mpc
heater_power: 72
cooling_fan: fan
ambient_temp_sensor: temperature_sensor beacon_coil
filament_diameter: 1.75
filament_density: 1.20
filament_heat_capacity: 1.8 

sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBBCan: PA3

[verify_heater extruder]
hysteresis: 10
check_gain_time: 40
heating_gain: 2
max_error: 500

[autotune_tmc extruder]
motor: ldo-36sth20-1004ahg
tuning_goal: auto
voltage: 24

[tmc2209 extruder]
uart_pin: EBBCan: PA15
run_current: 0.85
sense_resistor: 0.11 
stealthchop_threshold: 0
driver_TBL: 0
driver_HEND: 6
driver_HSTRT: 7
driver_TOFF: 4

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 30          
max_z_accel: 350
square_corner_velocity: 8

[adxl345]
cs_pin: EBBCan: PB12
spi_bus: spi2_PB2_PB11_PB10
axes_map: x,y,z

[resonance_tester]
#accel_chip: adxl345
accel_chip: beacon
accel_per_hz: 75
max_smoothing:0.5
#sweeping_accel: 400
#sweeping_period: 0
probe_points: 150, 150, 20

[shaketune]
result_folder: ~/printer_data/config/ShakeTune_results
number_of_results_to_keep: 10
keep_raw_data: False
show_macros_in_webui: True
timeout: 600
measurements_chunk_size: 2
max_freq: 200
dpi: 300

[input_shaper]
damping_ratio_x: 0.038
shaper_freq_x: 64.6  # frequency for the X mark of the test model
shaper_type: mzv
damping_ratio_y: 0.044
shaper_freq_y: 48.8 # frequency for the Y mark of the test model
shaper_type: mzv

[bed_mesh]
speed: 300
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: .025
move_check_distance: 5.0
mesh_pps: 2, 2
algorithm: bicubic
bicubic_tension: .2
horizontal_move_z: 2.5

#####################################################################
#   X/Y Stepper Settings
#####################################################################

[autotune_tmc stepper_x]
motor: omc-17hs19-2504s-h
tuning_goal: auto
voltage: 48

[autotune_tmc stepper_x1]
motor: omc-17hs19-2504s-h
tuning_goal: auto
voltage: 48

[autotune_tmc stepper_y]
motor: omc-17hs19-2504s-h
tuning_goal: auto 
voltage: 48

[autotune_tmc stepper_y1]
motor: omc-17hs19-2504s-h
tuning_goal: auto 
voltage: 48

[stepper_x] # Motor 7
step_pin: PD3
dir_pin: PD2
enable_pin: !PD4
endstop_pin: ^PF0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 200 for 1.8 degree stepper
position_endstop: 300
position_max: 300
homing_speed: 150
homing_retract_dist: 90
min_home_dist: 5
homing_positive_dir: true

[tmc5160 stepper_x]
cs_pin: PD7
spi_bus: spi4
interpolate: false
run_current: 1.0
sense_resistor: 0.050
stealthchop_threshold: 0

[stepper_x1] # Motor 10
step_pin: PG6
dir_pin: PC6
enable_pin: !PC8
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 200 for 1.8 degree stepper

[tmc5160 stepper_x1]
cs_pin: PG7
spi_bus: spi4
interpolate: false
run_current: 1.0
sense_resistor: 0.050
stealthchop_threshold: 0

[stepper_y] # Motor 8
step_pin: PA10
dir_pin: PA9
enable_pin: !PA15
endstop_pin: ^PF2 
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 200 for 1.8 degree stepper
position_endstop: 303
position_max: 303
homing_speed: 150
homing_retract_dist: 10
min_home_dist: 5
homing_positive_dir: true

[tmc5160 stepper_y]
cs_pin: PD6
spi_bus: spi4
interpolate: false
run_current: 1.0
sense_resistor: 0.050
stealthchop_threshold: 0

[stepper_y1] # Motor 9
step_pin: PA8
dir_pin: PC7
enable_pin: !PC9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 200 for 1.8 degree stepper

[tmc5160 stepper_y1]
cs_pin: PG8
spi_bus: spi4
interpolate: false
run_current: 1.0
sense_resistor: 0.050
stealthchop_threshold: 0

#####################################################################
#   Z Stepper Settings
#####################################################################

[autotune_tmc stepper_z]
motor: ldo-42sth48-2004ac
tuning_goal: auto 
voltage: 24

[autotune_tmc stepper_z1]
motor: ldo-42sth48-2004ac
tuning_goal: auto 
voltage: 24

[autotune_tmc stepper_z2]
motor: ldo-42sth48-2004ac
tuning_goal: auto 
voltage: 24

[autotune_tmc stepper_z3]
motor: ldo-42sth48-2004ac
tuning_goal: auto 
voltage: 24

[stepper_z] # Motor 3
step_pin: PE1
dir_pin: PE0
enable_pin: !PE2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3

[tmc5160 stepper_z]
cs_pin: PG12
spi_bus: spi4
interpolate: false
run_current: 0.8
sense_resistor: 0.050
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Left
[stepper_z1] # Motor 4
step_pin: PB8
dir_pin: PB9
enable_pin: !PB7
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc5160 stepper_z1]
cs_pin: PG11
spi_bus: spi4
interpolate: false
run_current: 0.8
sense_resistor: 0.050
stealthchop_threshold: 999999

##  Z2 Stepper - Rear Right
[stepper_z2] # Motor 5
step_pin: PB5
dir_pin: PB4
enable_pin: !PB6
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc5160 stepper_z2]
cs_pin: PG10
spi_bus: spi4
interpolate: false
run_current: 0.8
sense_resistor: 0.050
stealthchop_threshold: 999999

##  Z3 Stepper - Front Right
[stepper_z3] # Motor 6
step_pin: PG15
dir_pin: PB3
enable_pin: !PD5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[tmc5160 stepper_z3]
cs_pin: PG9
spi_bus: spi4
interpolate: false
run_current: 0.8
sense_resistor: 0.050
stealthchop_threshold: 999999


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PF5
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PB1
max_power: 1
min_temp: 0
max_temp: 125
pwm_cycle_time: 0.0166

#control: pid
#pid_Kp: 63.418 
#pid_Ki: 1.342 
#pid_Kd: 749.125

[heater_fan Bed_Fans]
pin: PA6
heater: heater_bed
heater_temp: 100.0

#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBBCan: PA0

[heater_fan hotend_fan]
pin: EBBCan: PA1
heater: extruder
heater_temp: 50.0

# [controller_fan stepper_fan]
# pin: PD14
# stepper: stepper_x, stepper_y
# fan_speed: 1
# shutdown_speed: 1

[controller_fan controller_fan]
pin: PA4
heater: heater_bed
stepper: stepper_x, stepper_y
fan_speed: 0.25
shutdown_speed: 1

#####################################################################
#   LED Control
#####################################################################

[output_pin caselight]
## Chamber Lighting - CNC_FAN5
pin: PA5
pwm:true
shutdown_value: 0
value:0
cycle_time: 0.01

#####################################################################
#   Additional Sensors
#####################################################################

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor Octopus_MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor chamber_temp]
sensor_type: Generic 3950
sensor_pin: PB0
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBBCan

#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 3600
gcode:
    TURN_OFF_HEATERS
    M84
    Case_Light_OFF
    M107

[delayed_gcode startup]
initial_duration: 1.0
gcode:
    Case_Light_Full

[quad_gantry_level]
gantry_corners:
   -60,-10
   360,370
points:
   50,25
   50,225
   250,225
   250,25
speed: 300
horizontal_move_z: 5
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# block_heat_capacity = 22.1870
#*# sensor_responsiveness = 0.0970366
#*# ambient_transfer = 0.116747
#*# fan_ambient_transfer = 0.116747, 0.122903, 0.12517, 0.137815, 0.147692, 0.141581, 0.14446, 0.148386, 0.150089, 0.154604
#*# pid_version = 1
#*# pid_target = 280.00
#*# pid_tolerance = 0.0200
#*# pid_kp = 12.726
#*# pid_ki = 0.590
#*# pid_kd = 68.639
#*# control = mpc
#*#
#*# [beacon model default]
#*# model_coef = 1.5147273562430432,
#*# 	  1.8514952667884155,
#*# 	  0.7769805373085563,
#*# 	  0.33901451309147307,
#*# 	  0.3707475344636432,
#*# 	  0.4518443869656849,
#*# 	  -0.23095925793582733,
#*# 	  -0.46352271961782743,
#*# 	  0.16790341528402414,
#*# 	  0.22249749346708772
#*# model_domain = 1.856210369347763e-07,1.936446632820396e-07
#*# model_range = 0.200417,5.000417
#*# model_temp = 40.933700
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.067011, -0.024159, 0.008842, -0.004851, -0.049543, -0.031927, -0.026131, -0.047859, -0.073489, -0.080706, -0.070447, -0.053164, -0.037539, -0.025220, -0.022490, -0.025827, -0.024224, -0.009778, 0.003095, -0.007127, -0.030394, -0.050664, -0.067928, -0.073193, -0.078888
#*# 	-0.069259, -0.071322, -0.062822, -0.047393, -0.056728, -0.035593, -0.028343, -0.049337, -0.074719, -0.083303, -0.073018, -0.054584, -0.039250, -0.028119, -0.024391, -0.026138, -0.026692, -0.013156, -0.000718, -0.009698, -0.031818, -0.052751, -0.068197, -0.074458, -0.080336
#*# 	-0.068835, -0.061415, -0.060811, -0.063552, -0.058949, -0.036000, -0.028982, -0.051265, -0.075591, -0.083660, -0.075014, -0.056439, -0.041054, -0.028935, -0.025313, -0.028547, -0.030994, -0.017566, -0.003937, -0.011321, -0.034273, -0.055996, -0.070399, -0.078161, -0.085156
#*# 	-0.066967, -0.063360, -0.068246, -0.068753, -0.060248, -0.036144, -0.027613, -0.046182, -0.075480, -0.084347, -0.072639, -0.056523, -0.041317, -0.028934, -0.027226, -0.033382, -0.032764, -0.020466, -0.005417, -0.014368, -0.038134, -0.060499, -0.075277, -0.082229, -0.088388
#*# 	-0.062892, -0.059414, -0.063795, -0.066220, -0.057356, -0.033127, -0.022454, -0.045763, -0.072382, -0.079507, -0.071363, -0.053051, -0.039482, -0.027616, -0.024657, -0.032108, -0.032708, -0.019999, -0.004300, -0.014219, -0.038372, -0.058846, -0.074611, -0.081456, -0.087158
#*# 	-0.057345, -0.054123, -0.058747, -0.062542, -0.052393, -0.029091, -0.017587, -0.037486, -0.064617, -0.074370, -0.065581, -0.047870, -0.035249, -0.025127, -0.022094, -0.028847, -0.028224, -0.016333, -0.003168, -0.013917, -0.036559, -0.058403, -0.074212, -0.080353, -0.084766
#*# 	-0.053319, -0.050472, -0.057691, -0.060010, -0.048561, -0.025333, -0.012306, -0.029832, -0.056867, -0.067684, -0.059911, -0.045261, -0.030180, -0.019583, -0.017353, -0.023267, -0.024210, -0.011004, 0.000492, -0.009072, -0.031237, -0.053341, -0.070036, -0.076350, -0.079099
#*# 	-0.048836, -0.047957, -0.057443, -0.061454, -0.048267, -0.022452, -0.008381, -0.025201, -0.051171, -0.063786, -0.056287, -0.038050, -0.023367, -0.013264, -0.010445, -0.017267, -0.017181, -0.004607, 0.006102, -0.005021, -0.026905, -0.050177, -0.067247, -0.072152, -0.073186
#*# 	-0.043378, -0.044032, -0.051918, -0.052927, -0.041300, -0.016963, -0.003457, -0.020550, -0.046735, -0.059295, -0.054193, -0.036072, -0.019370, -0.008165, -0.005157, -0.009084, -0.011771, -0.000091, 0.010756, 0.000921, -0.022583, -0.045476, -0.061472, -0.065675, -0.066510
#*# 	-0.039712, -0.040337, -0.046703, -0.047644, -0.038227, -0.013960, -0.000100, -0.016511, -0.044577, -0.056861, -0.050340, -0.034062, -0.016729, -0.005083, -0.002576, -0.006585, -0.008064, 0.002094, 0.013649, 0.002374, -0.022511, -0.044504, -0.059244, -0.065078, -0.067021
#*# 	-0.037212, -0.036110, -0.042395, -0.044006, -0.035170, -0.009739, 0.005829, -0.010898, -0.040769, -0.053180, -0.046151, -0.031151, -0.017019, -0.007601, -0.002455, -0.005544, -0.005051, 0.005481, 0.015947, 0.005274, -0.020223, -0.042567, -0.057242, -0.063379, -0.067417
#*# 	-0.041314, -0.039209, -0.042566, -0.042845, -0.034264, -0.008773, 0.007131, -0.009376, -0.041123, -0.052719, -0.044433, -0.033150, -0.018736, -0.005113, 0.002919, -0.006563, -0.005717, 0.004637, 0.014889, 0.004293, -0.020464, -0.044502, -0.059829, -0.067108, -0.071816
#*# 	-0.046156, -0.043078, -0.043640, -0.043717, -0.033424, -0.008462, 0.007468, -0.011039, -0.043070, -0.052465, -0.047271, -0.034373, -0.015333, 0.013582, 0.014736, 0.001325, -0.001495, 0.003962, 0.014233, 0.003049, -0.023232, -0.045487, -0.062425, -0.069122, -0.073565
#*# 	-0.050829, -0.048478, -0.048812, -0.047684, -0.037016, -0.010365, 0.004976, -0.013060, -0.045944, -0.054448, -0.043302, -0.033104, -0.004741, 0.000058, 0.005325, -0.007131, -0.008205, 0.001387, 0.012125, -0.000023, -0.024291, -0.046879, -0.064350, -0.070697, -0.077041
#*# 	-0.054179, -0.051395, -0.050871, -0.051010, -0.041509, -0.015869, 0.000709, -0.015427, -0.047991, -0.058469, -0.050118, -0.021344, -0.002385, 0.009071, 0.015615, -0.000487, -0.007402, -0.002227, 0.009072, -0.000911, -0.025028, -0.048779, -0.066947, -0.074038, -0.080298
#*# 	-0.055719, -0.053945, -0.055379, -0.056107, -0.046174, -0.020000, -0.001473, -0.018807, -0.051832, -0.062883, -0.052415, -0.037621, -0.020548, -0.002808, -0.003670, -0.012366, -0.016690, -0.005154, 0.007076, -0.002307, -0.026559, -0.050976, -0.069878, -0.078611, -0.085927
#*# 	-0.057307, -0.056294, -0.057981, -0.059028, -0.049153, -0.023602, -0.006425, -0.023725, -0.054379, -0.065343, -0.057643, -0.040491, -0.026749, -0.016618, -0.013576, -0.017657, -0.021301, -0.009598, 0.005464, -0.002130, -0.025876, -0.049876, -0.069515, -0.079023, -0.085630
#*# 	-0.060159, -0.059074, -0.060427, -0.063671, -0.054070, -0.029111, -0.010704, -0.027041, -0.057783, -0.069187, -0.062264, -0.047984, -0.035082, -0.023818, -0.017973, -0.022226, -0.025760, -0.013078, 0.002769, -0.004180, -0.027549, -0.050050, -0.067708, -0.078919, -0.086388
#*# 	-0.060294, -0.058443, -0.060888, -0.064169, -0.055406, -0.031426, -0.012958, -0.028017, -0.059605, -0.070724, -0.062993, -0.050749, -0.038391, -0.027304, -0.021782, -0.026752, -0.028803, -0.014982, 0.002254, -0.004863, -0.028907, -0.050596, -0.067056, -0.077695, -0.084718
#*# 	-0.061475, -0.059566, -0.061544, -0.064856, -0.054887, -0.032182, -0.014072, -0.029511, -0.062519, -0.074060, -0.064505, -0.053308, -0.041156, -0.031899, -0.026234, -0.029216, -0.030851, -0.018063, -0.001739, -0.005306, -0.027497, -0.049445, -0.064518, -0.076006, -0.084998
#*# 	-0.062390, -0.061022, -0.063893, -0.066320, -0.057894, -0.034274, -0.014875, -0.029911, -0.064128, -0.078983, -0.069242, -0.056952, -0.045833, -0.035360, -0.029693, -0.031067, -0.033248, -0.020761, -0.004483, -0.006776, -0.027869, -0.050190, -0.065770, -0.075813, -0.085829
#*# 	-0.063055, -0.061475, -0.064523, -0.070409, -0.061996, -0.040036, -0.019907, -0.034669, -0.068746, -0.086796, -0.075454, -0.062795, -0.049835, -0.039136, -0.032747, -0.035043, -0.038070, -0.026627, -0.007854, -0.010188, -0.031536, -0.052571, -0.068250, -0.079427, -0.086842
#*# 	-0.066453, -0.063601, -0.073175, -0.080632, -0.070465, -0.049305, -0.030959, -0.040659, -0.074534, -0.092562, -0.080488, -0.066993, -0.053360, -0.041985, -0.035894, -0.038934, -0.041562, -0.030176, -0.011206, -0.014934, -0.035670, -0.054710, -0.071554, -0.082548, -0.087960
#*# 	-0.071676, -0.070249, -0.079975, -0.091023, -0.074498, -0.053801, -0.039953, -0.049277, -0.078369, -0.093468, -0.083179, -0.069182, -0.055580, -0.044666, -0.038527, -0.043296, -0.046201, -0.035488, -0.016714, -0.018442, -0.039228, -0.058438, -0.076710, -0.085665, -0.090309
#*# 	-0.070207, -0.064886, -0.075004, -0.071734, -0.075441, -0.055040, -0.044891, -0.055912, -0.080779, -0.093468, -0.086234, -0.072226, -0.057419, -0.046591, -0.043438, -0.048281, -0.050760, -0.039423, -0.021244, -0.021953, -0.041419, -0.061963, -0.080479, -0.089032, -0.092750
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 60.072
#*# pid_ki = 2.482
#*# pid_kd = 363.438
